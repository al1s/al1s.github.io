"use strict";(self.webpackChunkcb_tree=self.webpackChunkcb_tree||[]).push([[98],{4746(e,t,o){o.d(t,{A:()=>h});var n=o(9379),r=o(5043),i=o(7152),s=o(6451),c=o(1806);const a=e=>({key:"".concat(Date.now(),"-").concat(Math.random().toString(16).slice(2)),userKey:e,timeCreated:Date.now()}),h=()=>{const{currentUser:e,logout:t,updateUser:o}=(0,i.A)(),[h,u]=(0,r.useState)(!1),l=()=>{if(!e)throw t(),Error("Not signed in");return e},d=e=>(0,c.wF)().filter(t=>t.userKey===e),g=(e,t)=>{const o=(0,c.wF)().filter(t=>t.userKey!==e);(0,c.FW)([...o,...t])},y=e=>{o(e)},m=async e=>{if(h)throw Error("Already submitting");u(!0);const t=e();return u(!1),t};return{deleteThoughtRecord:async e=>m(()=>{const t=l(),o=d(t.username).filter(t=>t.key!==e);g(t.username,o);const r=(0,n.A)((0,n.A)({},t),{},{thoughtRecords:t.thoughtRecords.filter(t=>t!==e),activeThoughtRecord:t.activeThoughtRecord===e?null:t.activeThoughtRecord});return y(r),e}),getAllThoughtRecords:async()=>m(()=>{const e=l();return d(e.username)}),updateThoughtRecord:async(e,t,o)=>m(()=>{const r=l(),i=d(r.username),s=i.findIndex(e=>e.key===t);if(s<0)throw Error("Record not found");const c=(0,n.A)((0,n.A)({},i[s]),{},{[o]:e}),a=[...i];return a[s]=c,g(r.username,a),c}),getActiveThoughtRecord:async()=>m(()=>{const e=l(),t=d(e.username),o=e.activeThoughtRecord?t.find(t=>t.key===e.activeThoughtRecord):void 0;if(o&&(0,s.f4)(o))return o;const r=a(e.username);return g(e.username,[...t,r]),y((0,n.A)((0,n.A)({},e),{},{activeThoughtRecord:r.key,thoughtRecords:Array.from(new Set([...e.thoughtRecords||[],r.key]))})),r}),getNewThoughtRecord:async()=>m(()=>{const e=l(),t=d(e.username),o=a(e.username);return g(e.username,[...t,o]),y((0,n.A)((0,n.A)({},e),{},{activeThoughtRecord:o.key,thoughtRecords:Array.from(new Set([...e.thoughtRecords||[],o.key]))})),o}),isSubmitting:h,saveThoughtRecord:async()=>m(()=>{const e=l(),t=(0,n.A)((0,n.A)({},e),{},{activeThoughtRecord:null});return y(t),t}),editThoughtRecord:async e=>m(()=>{const t=l(),o=d(t.username).find(t=>t.key===e);if(!o)throw Error("Invalid return");return y((0,n.A)((0,n.A)({},t),{},{activeThoughtRecord:o.key})),o})}}},6451(e,t,o){o.d(t,{J6:()=>r,L0:()=>s,b1:()=>i,f4:()=>c,fK:()=>n});const n=(e,t)=>e in t,r=e=>i.includes(e),i=["/emotion","/situationquestion","/mood","/thoughts","/evidencefor","/evidenceagainst","/alternativethought","/rerateemotion","/submit"],s={"/emotion":{label:"How do you feel?",type:"Emotion"},"/situationquestion":{label:"What is the Situation?",type:"Text"},"/mood":{label:"Add any emotions you felt and rate them",type:"Mood"},"/thoughts":{label:"List any thoughts and rate your Belief",type:"Thoughts"},"/evidencefor":{label:"What is the Evidence for",type:"Text"},"/evidenceagainst":{label:"What is the Evidence Against",type:"Text"},"/alternativethought":{label:"",type:"Text"},"/rerateemotion":{label:"How do you feel?",type:"Emotion"},"/submit":{label:"something",type:"Submit"}},c=e=>!!e&&"timeCreated"in e},9098(e,t,o){o.r(t),o.d(t,{default:()=>m});var n=o(9379),r=o(2554),i=o(4450),s=o(7039),c=o(4508),a=o(5475),h=o(835),u=o(7152),l=o(4746),d=o(5043),g=o(1806),y=o(579);const m=()=>{const{getNewThoughtRecord:e,editThoughtRecord:t,isSubmitting:o}=(0,l.A)(),m=(0,h.Zp)(),f=(0,s.dj)(),p=(0,d.useRef)(null),{currentUser:v}=(0,u.A)();if(!v)return m("/login"),(0,y.jsx)(y.Fragment,{});const b=v.firstName||v.username.split("@")[0],{thoughtRecords:R,activeThoughtRecord:k}=v;return(0,y.jsx)(y.Fragment,{children:(0,y.jsx)(i.ov,{minH:"70vh",children:(0,y.jsxs)(i.Tk,{textAlign:"center",spacing:10,mt:2,children:[(0,y.jsxs)(i.DZ,{children:["Welcome to CBTree ",b]}),(0,y.jsx)(i.N_,{as:a.N_,to:"/about",children:(0,y.jsx)(i.EY,{color:"whiteAlpha.800",as:"u",children:"What is a thought record?"})}),(0,y.jsxs)(r.e2,{spacing:6,size:"lg",children:[(0,y.jsx)(i.N_,{as:a.N_,to:"/thoughtrecords",children:(0,y.jsx)(r.$n,{disabled:!!R,isLoading:o,children:"View"})}),(0,y.jsx)(r.$n,{isLoading:o,onClick:async()=>{await e(),m("/emotion")},children:"New"}),(0,y.jsx)(r.$n,{disabled:!k,onClick:()=>(async e=>{const o=await t(e);m("/emotion",{state:(0,n.A)({},o)})})(k||""),isLoading:o,children:"Edit"})]}),(0,y.jsx)(i.cG,{borderColor:"whiteAlpha.300"}),(0,y.jsxs)(i.Tk,{spacing:4,children:[(0,y.jsx)(i.EY,{fontWeight:"bold",children:"Backup your data"}),(0,y.jsx)(r.$n,{onClick:()=>{const e=(0,g.$R)(),t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),o=URL.createObjectURL(t),n=document.createElement("a");n.href=o,n.download="cbtree-backup-".concat(Date.now(),".json"),document.body.appendChild(n),n.click(),n.remove(),URL.revokeObjectURL(o)},variant:"outline",children:"Download backup"}),(0,y.jsx)(r.$n,{onClick:()=>{var e;return null===(e=p.current)||void 0===e?void 0:e.click()},variant:"outline",children:"Restore from file"}),(0,y.jsx)("input",{ref:p,type:"file",accept:"application/json",onChange:async e=>{var t;const o=null===(t=e.target.files)||void 0===t?void 0:t[0];if(o)try{const e=await o.text(),t=JSON.parse(e);(0,g.Br)(t),f({status:"success",description:"Backup restored. Reloading\u2026"}),window.location.reload()}catch(n){n instanceof Error&&f({status:"error",description:n.message||"Unable to restore backup."})}finally{p.current&&(p.current.value="")}},style:{display:"none"}})]}),(0,y.jsxs)(i.EY,{color:"white",p:2,fontSize:14,children:["If you have any questions or concerns Contact us at:"," ",(0,y.jsx)(i.N_,{href:"mailto:kylehgc@gmail.com",children:(0,y.jsx)(i.EY,{color:"whiteAlpha.800",as:"u",children:"kylehgc@gmail.com"})})]}),(0,y.jsx)(i.N_,{href:"https://github.com/kylehgc/CBTree",children:(0,y.jsx)(c.Tv0,{size:80})})]})})})}}}]);
//# sourceMappingURL=98.5acb37c5.chunk.js.map